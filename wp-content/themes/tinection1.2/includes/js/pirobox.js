(function(A){A.fn.piroBox=function(C){C=jQuery.extend({my_speed:null,close_speed:300,bg_alpha:0.5,close_all:".piro_close,.piro_overlay",slideShow:null,slideSpeed:null},C);function B(){var U='<tr><td colspan="3" class="pirobox_up"></td></tr><tr><td class="t_l"></td><td class="t_c"></td><td class="t_r"></td></tr><tr><td class="c_l"></td><td class="c_c"><span><span></span></span><div></div></td><td class="c_r"></td></tr><tr><td class="b_l"></td><td class="b_c"></td><td class="b_r"></td></tr><tr><td colspan="3" class="pirobox_down"></td></tr>';var Y=A(document).height();var P=A(jQuery('<div class="piro_overlay"></div>').hide().css({"opacity":+C.bg_alpha,"height":Y+"px"}));var D=A(jQuery('<table class="pirobox_content" cellpadding="0" cellspacing="0"></table>'));var W=A(jQuery('<div class="caption"></div>'));var a=A(jQuery('<div class="piro_nav"></div>'));var F=A(jQuery('<a href="#close" class="piro_close" title="关闭"></a>'));var E=A(jQuery('<a href="#play" class="play" title="播放"></a>'));var O=A(jQuery('<a href="#stop" class="stop" title="暂停"></a>'));var N=A(jQuery('<a href="#prev" class="piro_prev" title="previous"></a>'));var V=A(jQuery('<a href="#next" class="piro_next" title="next"></a>'));A("body").append(P).append(D);D.append(U);A(".pirobox_up").append(F);A(".pirobox_down").append(a);A(".pirobox_down").append(E);E.hide();A(".pirobox_down").append(N).append(V);a.append(W);var J=N.width();D.hide();var G=A("a[class^='pirobox']");var Q=new Object();for(var I=0;I<G.length;I++){var M=A(G[I]);Q["a."+M.attr("class")]=0}var X=new Array();for(var b in Q){X.push(b)}for(var I=0;I<X.length;I++){A(X[I]).each(function(d){this.rel=d+1+"/"+A(X[I]).length});var H=A(X[I]+":first").addClass("first");var c=A(X[I]+":last").addClass("last")}A(G).each(function(d){this.rev=d+0});var Z=A(G).each(function(){this.href});var L=A("body").append('<div id="imgCache" style="display:none"></div').children("#imgCache");A.each(Z,function(d,e){A("<div/>").css({"background":"url("+e+")"}).appendTo(L)});var S=A(G);A.fn.fixPNG=function(){return this.each(function(){var d=A(this).css("backgroundImage");if(d.match(/^url\(["']?(.*\.png)["']?\)$/i)){d=RegExp.$1;A(this).css({"backgroundImage":"none","filter":"progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod="+(A(this).css("backgroundRepeat")=="no-repeat"?"crop":"scale")+", src='"+d+"')"}).each(function(){var e=A(this).css("position");if(e!="absolute"&&e!="relative"){A(this).css("position","relative")}})}})};A.browser.msie6=(A.browser.msie&&/MSIE 6\.0/i.test(window.navigator.userAgent));if(A.browser.msie6&&!/MSIE 8\.0/i.test(window.navigator.userAgent)){A(".t_l,.t_c,.t_r,.c_l,.c_r,.b_l,.b_c,.b_r,a.piro_next, a.piro_prev,a.piro_prev_out,a.piro_next_out,.c_c,.piro_close,a.play,a.stop").fixPNG();var R=A(document).height();P.css("height",R+"px")}if(A.browser.msie){C.close_speed=0}A(window).resize(function(){var d=A(document).height();P.css({"visibility":"visible","height":+d+"px"})});N.add(V).bind("click",function(e){e.preventDefault();var f=parseInt(A(S).filter(".imgitem").attr("rev"));var d=A(this).is(".piro_prev_out,.piro_prev")?A(S).eq(f-1):A(S).eq(f+1);if(!d.size()){d=A(this).is(".piro_prev_out,.piro_prev")?A(S).eq(A(S).size()-1):A(S).eq(0)}d.click();F.add(W).add(V).add(N).css("visibility","hidden")});A(S).each(function(e){var d=A(this);d.unbind();d.bind("click",function(h){h.preventDefault();K(d.attr("href"));var i=d.attr("href");var f=d.attr("title");var g=d.attr("rel");if(f==""){W.html("<p>"+i+'<em class="number">'+g+"</em><a href="+i+' class="link_to" target="_blank" title="查看原图"></a></p>')}else{W.html("<p>"+f+'<em class="number">'+g+"</em><a href="+i+' class="link_to" target="_blank" title="查看原图"></a></p>')}if(d.is(".last")){A(".number").css("text-decoration","underline")}else{A(".number").css("text-decoration","none")}if(d.is(".first")){N.hide();V.show()}else{V.add(N).show()}if(d.is(".last")){N.show();V.hide();E.css("width","0")}else{E.css("width","40px")}if(d.is(".last")&&d.is(".first")){N.add(V).hide();A(".number").hide();E.remove()}A(S).filter(".imgitem").removeClass("imgitem");d.addClass("imgitem");A(".c_c").removeClass("unique")})});var K=function(d){E.add(O).hide();F.add(W).add(V).add(N).css("visibility","hidden");if(D.is(":visible")){A(".c_c div").children().fadeOut(300,function(){A(".c_c div").children().remove();T(d)})}else{A(".c_c div").children().remove();D.show();P.fadeIn(300,function(){T(d)})}};var T=function(g){if(D.is(".loading")){return}D.addClass("loading");var e=new Image();e.onerror=function(){var i=A(D).height();D.css({marginTop:parseInt(A(document).scrollTop())-(i/1.9)});A(".c_c div").append('<p class="err_mess">原图不存在或路径不对:&nbsp;<a href="#close" class="close_pirobox">点击关闭</a></p>');A(".close_pirobox").bind("click",function(j){j.preventDefault();F.add(P).add(D).add(W).add(V).add(N).hide(0,function(){e.src=""});D.removeClass("loading")})};e.onload=function(){var m=e.height;var i=e.width;var n=A(D).height();var j=A(window).height();var k=A(window).width();A(e).height(m).width(i).hide();A(".c_c div").animate({height:m+"px",width:i+"px"},C.my_speed);var l=m/j*2.3;if(j<m){h_fix=l}else{h_fix=2}D.animate({height:(m+40)+"px",width:(i+40)+"px",marginLeft:"-"+((i)/2+20)+"px",marginTop:parseInt(A(document).scrollTop())-(m/h_fix)},C.my_speed,function(){A(".piro_nav,.caption").css({width:(i)+"px","margin-bottom":"10px"});A(".piro_nav").css("margin-left","-"+(i)/2+"px");var o=W.height();A(".c_c div").append(e);F.css("display","block");V.add(N).add(F).css("visibility","visible");W.css({"visibility":"visible","display":"block","opacity":"0.8","overflow":"hidden"});D.hover(function(){W.stop().fadeTo(200,0.8)},function(){W.stop().fadeTo(200,0)});A(e).fadeIn(300);D.removeClass("loading");if(C.slideShow===true){E.add(O).show()}else{E.add(O).hide()}})};e.src=g;A("html").bind("keyup",function(i){if(i.keyCode==27){i.preventDefault();if(A(e).is(":visible")||A(".c_c>div>p>a").is(".close_pirobox")){A(S).removeClass("slideshow").removeClass("imgitem");F.add(P).add(D).add(W).add(V).add(N).hide(0,function(){e.src=""});D.removeClass("loading");clearTimeout(f);A(S).children().removeAttr("class");A(".stop").remove();A(".c_c").append(E);A(".sc_menu").css("display","none");A("ul.sc_menu li a").removeClass("img_active").css("opacity","0.4");V.add(N).show().css({"top":"50%"});A(S).children().fadeTo(100,1)}}});A("html").bind("keyup",function(i){if(A(".imgitem").is(".first")){}else{if(i.keyCode==37){i.preventDefault();if(A(e).is(":visible")){clearTimeout(f);A(S).children().removeAttr("class");A(".stop").remove();A(".c_c").append(E);N.click()}}}});A("html").bind("keyup",function(i){if(A(".imgitem").is(".last")){}else{if(i.keyCode==39){i.preventDefault();if(A(e).is(":visible")){clearTimeout(f);A(S).children().removeAttr("class");A(".stop").remove();A(".c_c").append(E);V.click()}}}});var d=A(window).height();O.bind("click",function(i){i.preventDefault();clearTimeout(f);A(S).removeClass("slideshow");A(".stop").remove();A(".pirobox_down").append(E);V.add(N).css("width",J+"px")});E.bind("click",function(i){i.preventDefault();clearTimeout(f);if(A(e).is(":visible")){A(S).addClass("slideshow");A(".play").remove();A(".pirobox_down").append(O)}V.add(N).css({"width":"0px"});return h()});A(C.close_all).bind("click",function(i){A(S).removeClass("slideshow");clearTimeout(f);if(A(e).is(":visible")){i.preventDefault();F.add(P).add(D).add(W).add(V).add(N).hide(0,function(){e.src=""});D.removeClass("loading");A(S).removeClass("slideshow");V.add(N).css("width",J+"px").hide();A(".stop").remove();A(".pirobox_down").append(E);E.hide()}});if(C.slideShow===true){function h(){if(A(S).filter(".imgitem").is(".last")){clearTimeout(f);A(S).removeClass("slideshow");A(".stop").remove();A(".pirobox_down").append(E);V.add(N).css("width",J+"px")}else{if(A(S).is(".slideshow")&&A(e).is(":visible")){clearTimeout(f);V.click()}}}var f=setInterval(h,C.slideSpeed*1000)}}}B()}})(jQuery);